<!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>সোলেমান জুয়েলার্স – এডভান্সড জুয়েলারি ক্যালকুলেটর</title>
<style>
  // ... <!doctype html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>সোলেমান জুয়েলার্স – এডভান্সড জুয়েলারি ক্যাল্কুলেটর</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap');
  :root {
    --primary-color: #0ea5e9;
    --primary-dark: #0284c7;
    --secondary-color: #1e293b;
    --background-light: #f0f9ff;
    --background-gradient: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    --text-dark: #0f172a;
    --text-light: #475569;
    --card-background: rgba(255, 255, 255, 0.95);
    --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    --danger-color: #ef4444;
    --danger-dark: #b91c1c;
    --success-color: #10b981;
    --warning-color: #f59e0b;
    --gradient-glow: linear-gradient(45deg, #0ea5e9, #3b82f6, #06b6d4);
  }
  body {
    font-family: 'Noto Sans Bengali', system-ui, sans-serif;
    margin: 0;
    background: var(--background-gradient);
    color: var(--text-dark);
    overflow-x: hidden;
    position: relative;
  }
  body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 20% 80%, rgba(14, 165, 233, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
    z-index: -1;
    animation: backgroundShift 20s ease-in-out infinite alternate;
  }
  @keyframes backgroundShift {
    0% { transform: translateX(-10%) translateY(-10%); }
    100% { transform: translateX(10%) translateY(10%); }
  }
  .header-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
    color: #fff;
    padding: 16px 24px;
    border-bottom: 4px solid #0c4a6e;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 4px 20px rgba(14, 165, 233, 0.3);
    animation: headerGlow 3s ease-in-out infinite alternate;
  }
  @keyframes headerGlow {
    0% { box-shadow: 0 4px 20px rgba(14, 165, 233, 0.3); }
    100% { box-shadow: 0 4px 30px rgba(14, 165, 233, 0.5); }
  }
  .header-bar h2 {
    margin: 0;
    font-size: 26px;
    font-weight: 700;
    letter-spacing: 1px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .header-bar h2::before {
    content: '';
    width: 40px;
    height: 40px;
    background: var(--gradient-glow);
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
  }
  @keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.05); opacity: 0.8; }
  }
  .header-bar .info {
    font-size: 14px;
    text-align: right;
  }
  .header-bar .info .live-price {
    font-weight: bold;
    font-size: 1.1em;
    color: #fff;
    transition: all 0.3s;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
  }
  .header-bar .info .live-price::after {
    content: ' ✨';
    animation: sparkle 1.5s ease-in-out infinite;
  }
  @keyframes sparkle {
    0%, 100% { opacity: 0; transform: scale(0); }
    50% { opacity: 1; transform: scale(1); }
  }

  .container {
    max-width: 900px;
    margin: 24px auto;
    padding: 0 24px;
  }

  .tab-buttons {
    display: flex;
    flex-wrap: wrap;
    background: #fff;
    border-radius: 12px;
    padding: 6px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.06);
    margin-bottom: 24px;
    position: relative;
    overflow: hidden;
  }
  .tab-buttons::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    animation: shimmer 3s infinite;
  }
  @keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
  }
  .tab-button {
    flex: 1;
    padding: 12px 10px;
    border: none;
    background: transparent;
    border-radius: 8px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    color: var(--text-light);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-width: 120px;
    position: relative;
    overflow: hidden;
  }
  .tab-button::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: var(--gradient-glow);
    transition: left 0.3s ease;
    z-index: -1;
  }
  .tab-button:hover::before {
    left: 0;
  }
  .tab-button.active {
    background: var(--primary-color);
    color: #fff;
    box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
    transform: translateY(-2px);
  }
  .tab-button.active::before {
    left: 0;
  }
  .tab-pane {
    display: none;
  }
  .tab-pane.active {
    display: block;
    animation: fadeInUp 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(30px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .card {
    background: var(--card-background);
    backdrop-filter: blur(12px);
    border-radius: 16px;
    padding: 24px;
    box-shadow: var(--shadow);
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
    overflow: hidden;
  }
  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--gradient-glow);
  }

  h3 {
    color: var(--primary-dark);
    border-bottom: 2px solid #e0f2fe;
    padding-bottom: 10px;
    margin-top: 0;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 18px;
    position: relative;
  }
  h3::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--gradient-glow);
    transition: width 0.3s ease;
  }
  h3:hover::after {
    width: 100%;
  }
  h4 {
    color: #0c4a6e;
    margin-top: 24px;
    margin-bottom: 12px;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  label {
    display: block;
    font-size: 14px;
    margin-top: 12px;
    color: var(--text-light);
    font-weight: 600;
    transition: color 0.3s ease;
  }
  input, select {
    width: 100%;
    padding: 12px;
    border: 1px solid #cbd5e1;
    border-radius: 8px;
    margin-top: 6px;
    font-size: 15px;
    box-sizing: border-box;
    transition: all 0.3s ease;
    background: #f8fafc;
    position: relative;
  }
  input:focus, select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
    transform: scale(1.02);
  }

  .inline-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 16px;
    animation: slideIn 0.5s ease;
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
  }

  .btn {
    padding: 12px 18px;
    border: none;
    border-radius: 8px;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
    color: #fff;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    user-select: none;
    font-weight: bold;
    margin-top: 10px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    position: relative;
    overflow: hidden;
  }
  .btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    transition: left 0.5s;
  }
  .btn:hover::before {
    left: 100%;
  }
  .btn:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 15px rgba(14, 165, 233, 0.4);
  }
  .btn:active {
    transform: translateY(-1px) scale(1.02);
    box-shadow: 0 4px 8px rgba(14, 165, 233, 0.3);
  }

  .btn-alt {
    background: linear-gradient(90deg, #475569, var(--secondary-color));
  }
  .btn-alt:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 15px rgba(71, 85, 105, 0.4);
  }

  .btn-danger {
    background: linear-gradient(90deg, var(--danger-color), var(--danger-dark));
  }
  .btn-danger:hover {
    box-shadow: 0 8px 15px rgba(239, 68, 68, 0.4);
    transform: translateY(-3px) scale(1.05);
  }

  .btn-success {
    background: linear-gradient(90deg, var(--success-color), #059669);
  }
  .btn-success:hover {
    box-shadow: 0 8px 15px rgba(16, 185, 129, 0.4);
    transform: translateY(-3px) scale(1.05);
  }

  .btn-sm {
    padding: 5px 10px;
    font-size: 12px;
    margin-top: 0;
  }

  .results {
    background: var(--background-light);
    padding: 16px;
    border-radius: 8px;
    margin-top: 20px;
    line-height: 1.9;
    font-size: 15px;
    min-height: 70px;
    position: relative;
    overflow-wrap: break-word;
    border-left: 5px solid var(--primary-color);
    animation: fadeIn 0.4s ease, glow 2s ease-in-out infinite alternate;
    box-shadow: inset 0 0 10px rgba(14, 165, 233, 0.1);
  }
  @keyframes glow {
    0% { box-shadow: inset 0 0 10px rgba(14, 165, 233, 0.1); }
    100% { box-shadow: inset 0 0 20px rgba(14, 165, 233, 0.2); }
  }

  .hidden-details {
    display: none;
    margin-top: 10px;
    background: #e0f2fe;
    padding: 15px;
    border-radius: 8px;
    animation: fadeIn 0.5s, slideDown 0.5s ease;
  }
  @keyframes slideDown {
    from { max-height: 0; opacity: 0; }
    to { max-height: 500px; opacity: 1; }
  }

  hr {
    border: none;
    border-top: 1px dashed #94a3b8;
    margin: 12px 0;
  }
  .icon {
    width: 20px;
    height: 20px;
  }

  /* Bill History Styles */
  .bill-history-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  .bill-item {
    background: #fff;
    border: 1px solid #e2e8f0;
    border-left: 4px solid var(--primary-color);
    padding: 15px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }
  .bill-item:hover {
    transform: translateX(5px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
  }
  .bill-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: var(--gradient-glow);
    transform: scaleY(0);
    transition: transform 0.3s ease;
  }
  .bill-item:hover::before {
    transform: scaleY(1);
  }
  .bill-item-info {
    flex-grow: 1;
  }
  .bill-item-info strong {
    font-size: 1.1em;
    color: var(--text-dark);
  }
  .bill-item-info span {
    color: var(--text-light);
    font-size: 0.9em;
    display: block;
    margin-top: 4px;
  }
  .bill-item-actions {
    display: flex;
    flex-shrink: 0;
    gap: 10px;
  }

  /* Modal Styles */
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 2000;
    display: none;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(4px);
    animation: modalFade 0.3s ease;
  }
  @keyframes modalFade {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  .modal-content {
    background: #fff;
    padding: 30px;
    border-radius: 12px;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    position: relative;
    animation: modalSlide 0.3s ease;
    border: 1px solid rgba(255,255,255,0.2);
  }
  @keyframes modalSlide {
    from { transform: translateY(-50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }
  .modal-close {
    position: absolute;
    top: 10px;
    right: 15px;
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #999;
    line-height: 1;
    transition: all 0.3s ease;
  }
  .modal-close:hover {
    color: #333;
    transform: rotate(90deg);
  }
  .bill-details-table {
    width: 100%;
    margin-top: 15px;
  }
  .bill-details-table td {
    padding: 8px 4px;
    border-bottom: 1px solid #eee;
    transition: background 0.2s ease;
  }
  .bill-details-table tr:hover td {
    background: #f8fafc;
  }
  .bill-details-table tr:last-child td {
    border-bottom: none;
  }
  .bill-details-table td:first-child {
    font-weight: 600;
    color: var(--text-light);
  }
  .bill-details-table .total-row td {
    font-weight: bold;
    font-size: 1.1em;
    color: var(--primary-dark);
    border-top: 2px solid var(--primary-color);
    padding-top: 10px;
  }

  .site-footer {
    text-align: center;
    padding: 20px;
    margin-top: 30px;
    background: rgba(255, 255, 255, 0.7);
    color: var(--text-light);
    font-size: 14px;
    border-top: 1px solid #e0f2fe;
    position: relative;
  }
  .site-footer::after {
    content: '✨';
    position: absolute;
    top: -10px;
    right: 20px;
    font-size: 20px;
    animation: float 3s ease-in-out infinite;
  }
  @keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }
  .site-footer p {
    margin: 5px 0;
  }

  /* Styles for Old-to-New Calculator Tab */
  .otn_btn-details {
      background-color: #374151;
      color: white;
      border: none;
      padding: 5px 15px;
      font-size: 13px;
      font-family: 'Noto Sans Bengali', system-ui, sans-serif;
      border-radius: 9999px;
      cursor: pointer;
      margin-top: 12px;
      margin-bottom: 8px;
      transition: all 0.3s ease;
  }
  .otn_btn-details:hover {
    background-color: #1f2937;
    transform: scale(1.05);
  }
  #otn_calculation-details {
    margin-top: 12px;
    padding: 16px;
    border-radius: 8px;
    background-color: #e0f2fe;
    line-height: 1.8;
    animation: expand 0.5s ease;
  }
  @keyframes expand {
    from { height: 0; opacity: 0; }
    to { height: auto; opacity: 1; }
  }
  #otn_bill-preview-modal .modal-close-btn {
      position: absolute;
      top: 15px;
      right: 15px;
      background: #ef4444;
      color: white;
      border: none;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      font-size: 18px;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.3s ease;
  }
  #otn_bill-preview-modal .modal-close-btn:hover {
    background: #dc2626;
    transform: rotate(180deg);
  }

  /* New Features: Theme Toggle */
  .theme-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 1001;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4);
    transition: all 0.3s ease;
  }
  .theme-toggle:hover {
    transform: scale(1.1) rotate(180deg);
    box-shadow: 0 6px 20px rgba(14, 165, 233, 0.6);
  }
  body.dark-theme {
    --background-gradient: linear-gradient(135deg, #1e293b, #334155);
    --card-background: rgba(30, 41, 59, 0.95);
    --text-dark: #f1f5f9;
    --text-light: #94a3b8;
    --background-light: #334155;
  }

  /* Export Button */
  .export-section {
    margin-top: 20px;
    padding: 15px;
    background: rgba(16, 185, 129, 0.1);
    border-radius: 8px;
    text-align: center;
    animation: pulse 2s infinite;
  }
  .export-section button {
    margin: 0 5px;
  }

  /* Progress Bar for Calculations */
  .progress-bar {
    width: 100%;
    height: 6px;
    background: #e2e8f0;
    border-radius: 3px;
    overflow: hidden;
    margin-top: 10px;
    display: none;
  }
  .progress-fill {
    height: 100%;
    background: var(--gradient-glow);
    width: 0%;
    transition: width 0.3s ease;
    animation: progressAnimate 2s ease-in-out infinite;
  }
  @keyframes progressAnimate {
    0% { width: 0%; }
    50% { width: 70%; }
    100% { width: 100%; }
  }

  /* Responsive Enhancements */
  @media (max-width: 768px) {
    .inline-row {
      grid-template-columns: 1fr;
    }
    .header-bar {
      flex-direction: column;
      gap: 10px;
      text-align: center;
    }
    .tab-buttons {
      flex-direction: column;
    }
    .tab-button {
      min-width: auto;
    }
  }
</style>
</head>
<body>
  <svg width="0" height="0" style="display:none;">
    <symbol id="icon-calculator" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="10" x2="16" y2="18"/><line x1="12" y1="10" x2="12" y2="18"/><line x1="8" y1="10" x2="8" y2="18"/></symbol>
    <symbol id="icon-exchange" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5v14M19 12l-7 7-7-7"/></symbol>
    <symbol id="icon-sale" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></symbol>
    <symbol id="icon-history" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></symbol>
    <symbol id="icon-balance" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 5a5 5 0 0110 0m-5 0V3m0 2v13.5m-3.5-3.5h7m-12 0L8.5 7.5m10 0l-5.5 8.5"/></symbol>
    <symbol id="icon-recycle" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 4V2h10v2"/><path d="M10 18a4 4 0 0 0 4-4h4V7H6v7h4a4 4 0 0 0 4 4z"/><path d="M14 14v4"/><path d="M10 14v4"/><path d="M12 18v-4"/></symbol>
    <symbol id="icon-preview" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></symbol>
    <symbol id="icon-print" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></symbol>
    <symbol id="icon-theme" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></symbol>
    <symbol id="icon-export" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></symbol>
  </svg>

  <button class="theme-toggle" onclick="toggleTheme()" title="থিম পরিবর্তন করুন">
    <svg class="icon" style="width: 24px; height: 24px;"><use href="#icon-theme"/></svg>
  </button>

  <div class="header-bar">
    <h2><svg class="icon" style="width: 32px; height: 32px;"><use href="#icon-calculator"/></svg> সোলেমান জুয়েলার্স</h2>
    <div class="info">
      <div id="todayDate"></div>
      <div style="margin-top: 5px;">২৪ ক্যারেট: <span id="liveGoldPrice24ct" class="live-price">--</span></div>
      <div style="margin-top: 5px;">২২ ক্যারেট: <span id="liveGoldPrice22ct" class="live-price">--</span></div>
      <button class="btn btn-sm" onclick="fetchLivePrice()">লাইভ মূল্য দেখুন</button>
    </div>
  </div>

  <div class="container">
    <div class="tab-buttons">
      <button class="tab-button active" onclick="openTab('oldToNew')"><svg class="icon"><use href="#icon-recycle"/></svg> পুরাতন এক্সচেঞ্জ</button>
    </div>

    <div id="oldToNew" class="tab-pane active">
        <div class="card">
            <h3><svg class="icon"><use href="#icon-recycle"/></svg> পুরাতন সোনা দিয়ে নতুন গহনা তৈরি</h3>

            <h4>গ্রাহকের বিবরণ</h4>
            <div class="inline-row">
                <div><label>গ্রাহকের নাম</label><input id="otn_customerName" type="text" placeholder="নাম লিখুন" /></div>
                <div><label>মোবাইল নম্বর</label><input id="otn_customerMobile" type="tel" placeholder="নম্বর লিখুন" /></div>
            </div>

            <h4>পুরাতন গহনার বিবরণ</h4>
            <div class="inline-row">
                <div><label>পুরানো সোনার ওজন (গ্রাম)</label><input id="otn_OldWeight" type="number" step="0.001" value="10" min="0" /></div>
                <div><label>পুরানো সোনার ওজন (আনা)</label><input id="otn_OldWeightInAna" type="number" step="0.001" placeholder="আনা লিখুন" min="0" /></div>
            </div>
            <label>পুরানো সোনার প্রকার</label>
            <select id="otn_OldType">
                <option value="Licence">হলমার্ক 22K916</option>
                <option value="bengali" selected>বাংলা সোনা 18K750</option>
                <option value="kdm_850">KDM 20K850</option>
                <option value="desi_bengali">দেশি বাংলা সোনা 15K650</option>
            </select>

            <h4>নতুন গহনার বিবরণ</h4>
            <div class="inline-row">
                <div><label>নতুন গহনার ওজন (গ্রাম)</label><input id="otn_NewWeight" type="number" step="0.001" value="10" min="0" /></div>
                <div><label>নতুন গহনার ওজন (আনা)</label><input id="otn_NewWeightInAna" type="number" step="0.001" placeholder="আনা লিখুন" min="0" /></div>
            </div>
            <label>নতুন গহনার প্রকার</label>
            <select id="otn_NewType">
                <option value="Licence">হলমার্ক 22K916</option>
                <option value="kdm_850">KDM 20K850</option>
                <option value="bengali">বাংলা সোনা 18K750</option>
                <option value="desi_bengali">দেশি বাংলা সোনা 15K650</option>
            </select>

            <hr>
            <h4>মূল্য ও চার্জ</h4>
            <div class="inline-row">
                <div><label>২৪ ক্যারেট সোনার দাম (১০ গ্রাম) – ₹</label><input id="otn_BasePrice24ct" type="number" step="100" value="126000" min="0" /></div>
                <div><label>মজুরি প্রতি গ্রাম – ₹</label><input id="otn_MakingCharge" type="number" step="1" value="500" min="0" /></div>
                <div><label>GST (%)</label><input id="otn_GstPercent" type="number" step="0.1" value="3" min="0" /></div>
            </div>

            <div id="otn_oldToNewOutput" class="results">ফলাফল এখানে আসবে...</div>
            <div class="progress-bar" id="otnProgress"><div class="progress-fill"></div></div>

            <div style="margin-top: 16px; display:flex; gap: 12px; flex-wrap: wrap; justify-content: flex-start;">
                <button class="btn" onclick="otn_printBill()"><svg class="icon"><use href="#icon-print"/></svg> সেভ ও প্রিন্ট করুন</button>
                <button class="btn btn-alt" onclick="otn_previewBill()"><svg class="icon"><use href="#icon-preview"/></svg> বিল প্রিভিউ দেখুন</button>
                <button class="btn btn-alt" onclick="otn_resetOldToNew()">♻ রিসেট করুন</button>
            </div>
        </div>
    </div>

  </div>

  <footer class="site-footer">
    <p><strong>সোলেমান জুয়েলার্স</strong></p>
    <p>ঠিকানা: ভাদুরিয়াপাড়া বাজার | মোবাইল: 8967575884</p>
    <p>GSTIN: 19BMZPR4273E1Z9 | BIS Licence: HM/C-5191720314</p>
  </footer>

  <div class="modal-overlay" id="otn_bill-preview-modal">
    <div class="modal-content">
      <button class="modal-close-btn" onclick="otn_closeModal()">&times;</button>
      <div id="otn_bill-preview-content"></div>
    </div>
  </div>

<script>
// --- CONSTANTS & UTILITY FUNCTIONS ---
const $ = (selector) => document.querySelector(selector);
const getVal = (id) => parseFloat($(`#${id}`).value) || 0;
const getStr = (id) => $(`#${id}`).value.trim() || 'N/A';
const toFixedTrim = (n, d = 2) => parseFloat(n.toFixed(d));
const GRAMS_TO_ANA_RATE = 1.372;
let otn_calculationResult = {}; // Global object to store results for old-to-new tab

function gramsToAnaString(weightInGrams) {
    const totalAna = weightInGrams * GRAMS_TO_ANA_RATE;
    return `${totalAna.toFixed(3)} আনা`;
}

function animateValue(obj, start, end, duration) {
  let startTimestamp = null;
  const step = (timestamp) => {
    if (!startTimestamp) startTimestamp = timestamp;
    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
    obj.textContent = `₹${Math.floor(progress * (end - start) + start).toLocaleString('en-IN')}`;
    if (progress < 1) { window.requestAnimationFrame(step); }
  };
  window.requestAnimationFrame(step);
}

// New Feature: Theme Toggle
function toggleTheme() {
  document.body.classList.toggle('dark-theme');
  localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
}

// Load Theme
function loadTheme() {
  if (localStorage.getItem('theme') === 'dark') {
    document.body.classList.add('dark-theme');
  }
}

// Progress Bar Animation
function showProgress(id) {
  const progress = $(`#${id}`);
  progress.style.display = 'block';
  const fill = progress.querySelector('.progress-fill');
  fill.style.width = '0%';
  setTimeout(() => { fill.style.width = '100%'; }, 100);
  setTimeout(() => { progress.style.display = 'none'; }, 2000);
}

// --- TAB HANDLING ---
function openTab(tabName) {
  document.querySelectorAll('.tab-pane').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
  $(`#${tabName}`).classList.add('active');
  $(`button[onclick="openTab('${tabName}')"]`).classList.add('active');
}

// --- LIVE PRICE ---
function fetchLivePrice() {
    const livePriceDisplay24ct = $('#liveGoldPrice24ct');
    const livePriceDisplay22ct = $('#liveGoldPrice22ct');
    const currentPrice24ct = getVal('otn_BasePrice24ct');

    if (currentPrice24ct > 0) {
        const currentPrice22ct = currentPrice24ct * 0.98; // আপনার কোড অনুযায়ী 0.98 ব্যবহার করা হয়েছে
        animateValue(livePriceDisplay24ct, currentPrice24ct - 500, currentPrice24ct, 1500);
        animateValue(livePriceDisplay22ct, currentPrice22ct - 500, currentPrice22ct, 1500);
    } else {
        livePriceDisplay24ct.textContent = 'N/A';
        livePriceDisplay22ct.textContent = 'N/A';
    }
}

// --- OLD TO NEW CALCULATOR SCRIPT ---
function otn_calculateOldToNew() {
  showProgress('otnProgress');
    const oldWeight = getVal('otn_OldWeight');
    const oldType = $('#otn_OldType').value;
    const newWeight = getVal('otn_NewWeight');
    const newType = $('#otn_NewType').value;
    const price24ct = getVal('otn_BasePrice24ct');
    const makingCharge = getVal('otn_MakingCharge');
    const gstPercent = getVal('otn_GstPercent');

    otn_calculationResult = {
        oldWeight,
        oldType: $('#otn_OldType').options[$('#otn_OldType').selectedIndex].text,
        newWeight,
        newType: $('#otn_NewType').options[$('#otn_NewType').selectedIndex].text,
        price24ct,
        makingCharge,
        gstPercent,
        pureGoldEq: 0
    };

    if (oldWeight <= 0 || newWeight <= 0 || price24ct <= 0) {
        $('#otn_oldToNewOutput').innerHTML = 'অনুগ্রহ করে সমস্ত সঠিক তথ্য লিখুন।';
        return;
    }

    let pureGoldEq;

    // === আপনার অনুরোধ অনুযায়ী বিশেষ লজিক ===

    // Hallmark (85) to Others
    if (oldType === 'Licence' && newType === 'kdm_850') {
        pureGoldEq = oldWeight * 85 / 85; // 10.000
    }
    else if (oldType === 'Licence' && newType === 'bengali') {
        pureGoldEq = oldWeight * 85 / 75; // 11.333
    }
    else if (oldType === 'Licence' && newType === 'desi_bengali') {
        pureGoldEq = oldWeight * 85 / 65; // 13.076
    }

    // KDM 850 (78) to Others
    else if (oldType === 'kdm_850' && newType === 'Licence') {
        pureGoldEq = oldWeight * 78 / 92; // 8.478
    }
    else if (oldType === 'kdm_850' && newType === 'kdm_850') {
        pureGoldEq = oldWeight * 78 / 85; // 9.176
    }
    else if (oldType === 'kdm_850' && newType === 'bengali') {
        pureGoldEq = oldWeight * 78 / 75; // 10.400
    }
    else if (oldType === 'kdm_850' && newType === 'desi_bengali') {
        pureGoldEq = oldWeight * 78 / 65; // 12.000
    }

    // Bengali (65) to Others
    else if (oldType === 'bengali' && newType === 'kdm_850') {
        pureGoldEq = oldWeight * 65 / 85; // 7.647
    }
    else if (oldType === 'bengali' && newType === 'desi_bengali') {
        pureGoldEq = oldWeight * 65 / 58; // 11.206
    }
    else if (oldType === 'bengali' && newType === 'bengali') {
        pureGoldEq = oldWeight * 65 / 75;
    }

    // === নতুন যোগ করা হয়েছে: Desi Bengali (58) to Others ===
    else if (oldType === 'desi_bengali' && newType === 'Licence') {
        pureGoldEq = oldWeight * 58 / 92; // 6.304
    }
     else if (oldType === 'desi_bengali' && newType === 'kdm_850') {
        pureGoldEq = oldWeight * 58 / 85; // 6.823
    }
     else if (oldType === 'desi_bengali' && newType === 'bengali') {
        pureGoldEq = oldWeight * 58 / 75; // 7.733
    }
     else if (oldType === 'desi_bengali' && newType === 'desi_bengali') {
        pureGoldEq = oldWeight * 58 / 65; // 8.923
    }
    // ===============================================

    // === জেনেরিক / ফলব্যাক লজিক ===
    else {
        // ফলব্যাক পুরানো পিউরিটি ফ্যাক্টর
        const oldPurityFactors = {
            Licence: 85/92,
            bengali: 65/92,
            kdm_850: 78/92,
            desi_bengali: 58/92 // ফলব্যাক ফ্যাক্টর
        };
        pureGoldEq = oldWeight * (oldPurityFactors[oldType] || 65/92); // bengali কে ডিফল্ট ধরা হচ্ছে
    }
    // ===============================================

    otn_calculationResult.pureGoldEq = pureGoldEq;

    const deductionInGrams = oldWeight - pureGoldEq;

    const newGoldPriceRatio = {
        Licence: 0.98,
        bengali: 0.81,
        kdm_850: 0.91, // 20K850 এর জন্য আনুমানিক অনুপাত
        desi_bengali: 0.71
    };

    const deficitWeight = newWeight - pureGoldEq;
    let detailsHTML, summaryHTML;

    if (deficitWeight < -0.001) { // Case 1: EXCESS gold
        const excessGoldInGrams = Math.abs(deficitWeight);
        const pricePerGramNew = (price24ct * (newGoldPriceRatio[newType] || 0.91)) / 10;
        const creditValue = excessGoldInGrams * pricePerGramNew;
        const totalMakingCharge = newWeight * makingCharge;
        let finalPayable = 0, finalRefundable = 0;

        if (totalMakingCharge > creditValue) {
            let payableMakingCharge = totalMakingCharge - creditValue;
            let gstOnPayable = payableMakingCharge * (gstPercent / 100);
            finalPayable = payableMakingCharge + gstOnPayable;
        } else {
            finalRefundable = creditValue - totalMakingCharge;
        }

        detailsHTML = `
            <strong>প্রাপ্ত পাকা সোনার ওজন:</strong> ${pureGoldEq.toFixed(3)} গ্রাম / ${gramsToAnaString(pureGoldEq)}<hr>
            <strong>বাদ গেছে:</strong> ${deductionInGrams.toFixed(3)} গ্রাম / ${gramsToAnaString(deductionInGrams)}<hr>
            <strong>অতিরিক্ত সোনা রয়েছে:</strong> ${excessGoldInGrams.toFixed(3)} গ্রাম / ${gramsToAnaString(excessGoldInGrams)}<hr>
            <strong>নতুন গহনার মোট মজুরি:</strong> ₹${totalMakingCharge.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}<br>
            <strong>অতিরিক্ত সোনার জন্য ক্রেডিট:</strong> ₹${creditValue.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
        `;
        summaryHTML = finalPayable > 0.01
            ? `<strong style="font-size: 1.2em;">সর্বমোট প্রদেয় মূল্য: <span style="color: var(--primary-dark);">₹${finalPayable.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></strong>`
            : `<strong style="font-size: 1.2em;">দোকান ফেরত দেবে: <span style="color: var(--danger-dark);">₹${finalRefundable.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></strong>`;

        Object.assign(otn_calculationResult, { finalPayable, finalRefundable, creditValue, totalMakingCharge, excessGoldInGrams, deductionInGrams });
    }
    else { // Case 2: DEFICIT of gold
        const pricePerGramNew = (price24ct * (newGoldPriceRatio[newType] || 0.91)) / 10;
        const costOfDeficitGold = deficitWeight * pricePerGramNew;
        const totalMakingCharge = newWeight * makingCharge;
        const subtotal = costOfDeficitGold + totalMakingCharge;
        const gstAmount = subtotal * (gstPercent / 100);
        const totalPayable = subtotal + gstAmount;

        let pricePerAnaText = '';
        if (deficitWeight > 0.001) {
            const makingChargeForDeficit = deficitWeight * makingCharge;
            const subtotalForDeficit = costOfDeficitGold + makingChargeForDeficit;
            const gstForDeficit = subtotalForDeficit * (gstPercent / 100);
            const totalCostForDeficit = subtotalForDeficit + gstForDeficit;
            const deficitInAna = deficitWeight * GRAMS_TO_ANA_RATE;
            if (deficitInAna > 0) {
                const pricePerAna = totalCostForDeficit / deficitInAna;
                pricePerAnaText = ` <span style="font-size: 0.9em; color: var(--text-light);">(মজুরি ও GST সহ প্রতি আনা প্রায় ₹${pricePerAna.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})})</span>`;
            }
        }

        detailsHTML = `
            <strong>প্রাপ্ত পাকা সোনার ওজন:</strong> ${pureGoldEq.toFixed(3)} গ্রাম / ${gramsToAnaString(pureGoldEq)}<hr>
            <strong>বাদ গেছে:</strong> ${deductionInGrams.toFixed(3)} গ্রাম / ${gramsToAnaString(deductionInGrams)}<hr>
            <strong>অতিরিক্ত সোনা কিনতে হবে:</strong> ${deficitWeight.toFixed(3)} গ্রাম / ${gramsToAnaString(deficitWeight)}<hr>
            <strong>অতিরিক্ত সোনার মূল্য:</strong> ₹${costOfDeficitGold.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}${pricePerAnaText}<br>
            <strong>নতুন গহনার (${newWeight} গ্রাম) মজুরি:</strong> ₹${totalMakingCharge.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}<br>
            <strong>সাবটোটাল (মূল্য + মজুরি):</strong> ₹${subtotal.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}<br>
            <strong>GST (${gstPercent}%):</strong> ₹${gstAmount.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}
        `;
        summaryHTML = `<strong style="font-size: 1.2em;">সর্বমোট প্রদেয় মূল্য: <span style="color: var(--primary-dark);">₹${totalPayable.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</span></strong>`;
        Object.assign(otn_calculationResult, { totalPayable, costOfDeficitGold, totalMakingCharge, subtotal, gstAmount, deficitWeight, deductionInGrams });
    }

    otn_calculationResult.detailsHTML = detailsHTML;

    $('#otn_oldToNewOutput').innerHTML = `
        <div style="margin-bottom: 8px;">${summaryHTML}</div>
        <button class="otn_btn-details" onclick="otn_toggleDetails(this)">সম্পূর্ণ হিসাব দেখুন</button>
        <div id="otn_calculation-details" style="display: none;">${detailsHTML}</div>
    `;
}

function otn_toggleDetails(button) {
    const details = $('#otn_calculation-details');
    if (details.style.display === 'none') {
        details.style.display = 'block';
        button.textContent = 'সম্পূর্ণ হিসাব';
    } else {
        details.style.display = 'none';
        button.textContent = 'সম্পূর্ণ হিসাব দেখুন';
    }
}

function otn_resetOldToNew() {
    $('#otn_customerName').value = '';
    $('#otn_customerMobile').value = '';
    $('#otn_OldWeight').value = '10';
    $('#otn_OldWeightInAna').value = (10 * GRAMS_TO_ANA_RATE).toFixed(3);
    $('#otn_OldType').value = 'bengali';
    $('#otn_NewWeight').value = '10';
    $('#otn_NewWeightInAna').value = (10 * GRAMS_TO_ANA_RATE).toFixed(3);
    $('#otn_NewType').value = 'Licence';
    $('#otn_BasePrice24ct').value = '126000';
    $('#otn_MakingCharge').value = '500';
    $('#otn_GstPercent').value = '3';
    otn_calculateOldToNew();
}

function otn_generateBillHTML() {
    const customerName = $('#otn_customerName').value || 'N/A';
    const customerMobile = $('#otn_customerMobile').value || 'N/A';
    const now = new Date();
    const dateStr = now.toLocaleDateString('bn-IN', { day: '2-digit', month: 'long', year: 'numeric' });
    const timeStr = now.toLocaleTimeString('bn-IN', { hour: '2-digit', minute: '2-digit' });

    let finalAmountText = '';
    if (otn_calculationResult.hasOwnProperty('totalPayable')) {
        finalAmountText = `<tr><td colspan="3" style="text-align: right; font-weight: bold; font-size: 1.2em;">সর্বমোট প্রদেয় মূল্য:</td><td style="text-align:right; font-weight: bold; font-size: 1.2em;">₹${otn_calculationResult.totalPayable.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td></tr>`;
    } else if (otn_calculationResult.hasOwnProperty('finalPayable') && otn_calculationResult.finalPayable > 0.01) {
        finalAmountText = `<tr><td colspan="3" style="text-align: right; font-weight: bold; font-size: 1.2em;">সর্বমোট প্রদেয় মূল্য:</td><td style="text-align:right; font-weight: bold; font-size: 1.2em;">₹${otn_calculationResult.finalPayable.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td></tr>`;
    } else {
         finalAmountText = `<tr><td colspan="3" style="text-align: right; font-weight: bold; font-size: 1.2em;">দোকান ফেরত দেবে:</td><td style="text-align:right; font-weight: bold; font-size: 1.2em;">₹${(otn_calculationResult.finalRefundable || 0).toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2})}</td></tr>`;
    }

    return `
        <div style="font-family: 'Noto Sans Bengali', sans-serif; color: #0f172a; padding: 15px;">
            <div style="text-align: center; border-bottom: 2px solid #0ea5e9; padding-bottom: 10px; margin-bottom: 20px;">
                <h2 style="margin: 0; font-size: 28px; color: #0284c7;">সোলেমান জুয়েলার্স</h2>
                <p style="margin: 5px 0;">ঠিকানা: ভাদুরিয়াপাড়া বাজার | মোবাইল: 8967575884</p>
                <p style="margin: 5px 0; font-size: 12px;">GSTIN: 19BMZPR4273E1Z9 | BIS Licence: HM/C-5191720314</p>
                <h3 style="margin: 15px 0 5px; font-size: 20px; color: #1e293b;">গহনা বিনিময়ের বিল</h3>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <div><strong>গ্রাহকের নাম:</strong> ${customerName}</div>
                <div><strong>তারিখ:</strong> ${dateStr}</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <div><strong>মোবাইল নম্বর:</strong> ${customerMobile}</div>
                <div><strong>সময়:</strong> ${timeStr}</div>
            </div>
            <table style="width: 100%; border-collapse: collapse; font-size: 14px;">
                <thead>
                    <tr style="background-color: #f1f5f9;">
                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid #cbd5e1;">বিবরণ</th>
                    <th style="padding: 10px; text-align: right; border-bottom: 1px solid #cbd5e1;">ওজন (গ্রাম)</th>
                    <th style="padding: 10px; text-align: right; border-bottom: 1px solid #cbd5e1;">হার (₹)</th>
                    <th style="padding: 10px; text-align: right; border-bottom: 1px solid #cbd5e1;">মোট (₹)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="4" style="background: #f1f5f9; font-weight:bold;">পুরাতন গহনা</td></tr>
                    <tr><td>${otn_calculationResult.oldType}</td><td style="text-align: right;">${otn_calculationResult.oldWeight.toFixed(3)} গ্রাম</td><td>-</td><td>-</td></tr>
                    <tr><td colspan="3" style="text-align: right;">বাদ গেছে:</td><td style="text-align: right;">${(otn_calculationResult.deductionInGrams || 0).toFixed(3)} গ্রাম</td></tr>
                    <tr><td colspan="3" style="text-align: right; font-weight:bold;">প্রাপ্ত পাকা সোনার ওজন:</td><td style="text-align: right; font-weight:bold;">${(otn_calculationResult.pureGoldEq || 0).toFixed(3)} গ্রাম</td></tr>

                    <tr><td colspan="4" style="background: #f1f5f9; font-weight:bold;">নতুন গহনা</td></tr>
                    <tr><td>${otn_calculationResult.newType}</td><td style="text-align: right;">${otn_calculationResult.newWeight.toFixed(3)} গ্রাম</td><td>-</td><td>-</td></tr>

                    ${otn_calculationResult.deficitWeight > 0.001 ? `
                    <tr><td colspan="2">অতিরিক্ত সোনা কিনতে হবে (${otn_calculationResult.deficitWeight.toFixed(3)} গ্রাম)</td><td style="text-align: right;">-</td><td style="text-align: right;">${(otn_calculationResult.costOfDeficitGold || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}</td></tr>
                    <tr><td colspan="2">নতুন গহনার মজুরি (${otn_calculationResult.newWeight.toFixed(3)} গ্রাম)</td><td style="text-align: right;">${otn_calculationResult.makingCharge}/গ্রাম</td><td style="text-align: right;">${(otn_calculationResult.totalMakingCharge || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}</td></tr>
                    <tr><td colspan="3" style="text-align: right;">সাবটোটাল:</td><td style="text-align: right;">${(otn_calculationResult.subtotal || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}</td></tr>
                    <tr><td colspan="3" style="text-align: right;">GST (${otn_calculationResult.gstPercent}%):</td><td style="text-align: right;">${(otn_calculationResult.gstAmount || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}</td></tr>
                    ` : `
                    <tr><td colspan="2">নতুন গহনার মজুরি (${otn_calculationResult.newWeight.toFixed(3)} গ্রাম)</td><td style="text-align: right;">${otn_calculationResult.makingCharge}/গ্রাম</td><td style="text-align: right;">${(otn_calculationResult.totalMakingCharge || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}</td></tr>
                    <tr><td colspan="3" style="text-align: right;">অতিরিক্ত সোনার জন্য ক্রেডিট:</td><td style="text-align: right;">- ₹${(otn_calculationResult.creditValue || 0).toLocaleString('en-IN', {minimumFractionDigits: 2})}</td></tr>
                    `}
                </tbody>
                <tfoot>
                    <tr style="border-top: 2px solid #94a3b8;">
                        ${finalAmountText}
                    </tr>
                </tfoot>
            </table>
             <div style="margin-top: 30px; text-align: right;">
                <p style="margin: 0;">--------------------------</p>
                <p style="margin: 5px 0;">স্বাক্ষর</p>
            </div>
        </div>
    `;
}

function otn_previewBill() {
    otn_calculateOldToNew(); // প্রথমে হিসাবটি পুনরায় করুন
    if (!otn_calculationResult.pureGoldEq || otn_calculationResult.pureGoldEq <= 0) {
        alert("অনুগ্রহ করে সঠিক তথ্য পূরণ করুন।");
        return;
    }
    const billContent = otn_generateBillHTML();
    $('#otn_bill-preview-content').innerHTML = billContent;
    $('#otn_bill-preview-modal').style.display = 'flex';
}

function otn_closeModal() {
    $('#otn_bill-preview-modal').style.display = 'none';
}

function otn_printBill() {
    otn_calculateOldToNew(); // প্রথমে হিসাবটি পুনরায় করুন
    if (!otn_calculationResult.pureGoldEq || otn_calculationResult.pureGoldEq <= 0) {
        alert("প্রিন্ট করার আগে অনুগ্রহ করে সঠিক তথ্য পূরণ করুন।");
        return;
    }
    const billContent = otn_generateBillHTML();
    const printWindow = window.open('', '', 'height=800,width=800');
    printWindow.document.write('<html><head><title>Bill</title>');
    printWindow.document.write('<style>@import url("https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600;700&display=swap"); body { font-family: "Noto Sans Bengali", sans-serif; margin: 20px; }</style>');
    printWindow.document.write('</head><body>');
    printWindow.document.write(billContent);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    setTimeout(() => {
        printWindow.print();
    }, 500);
}


window.onload = function() {
  $('#todayDate').textContent = new Date().toLocaleDateString('bn-BD',{year:'numeric',month:'long',day:'numeric'});
  loadTheme();

  // --- ANA/GRAM CONVERSION LISTENERS ---
  let isCalculating = false;
  function setupWeightConversion(gramId, anaId, calcFunc) {
      const gramInput = $(`#${gramId}`);
      const anaInput = $(`#${anaId}`);

      gramInput.addEventListener('input', () => {
          if (isCalculating) return;
          isCalculating = true;
          const grams = getVal(gramId);
          anaInput.value = grams > 0 ? (grams * GRAMS_TO_ANA_RATE).toFixed(3) : '';
          isCalculating = false;
          // ইনপুট ইভেন্ট ট্রিগার করুন যাতে মূল ক্যালকুলেটর রিয়েল-টাইমে আপডেট হয়
          gramInput.dispatchEvent(new Event('change', { bubbles: true }));
      });

      anaInput.addEventListener('input', () => {
          if (isCalculating) return;
          isCalculating = true;
          const anas = getVal(anaId);
          gramInput.value = anas > 0 ? (anas / GRAMS_TO_ANA_RATE).toFixed(3) : '0';
          isCalculating = false;
          // ইনপুট ইভেন্ট ট্রিগার করুন যাতে মূল ক্যালকুলেটর রিয়েল-টাইমে আপডেট হয়
          gramInput.dispatchEvent(new Event('change', { bubbles: true }));
      });
  }

  // Setup for oldToNew tab
  setupWeightConversion('otn_OldWeight', 'otn_OldWeightInAna');
  setupWeightConversion('otn_NewWeight', 'otn_NewWeightInAna');

  // Main Event Listeners for Real-time Calculation
  // 'change' ব্যবহার করা হচ্ছে যাতে আনা কনভার্সনের পরেও ট্রিগার হয়
  document.querySelectorAll('#oldToNew input, #oldToNew select').forEach(input => {
      input.addEventListener('change', otn_calculateOldToNew);
      input.addEventListener('keyup', otn_calculateOldToNew); // টাইপিং এর সময়ও আপডেট করার জন্য
  });

  const otnModal = $('#otn_bill-preview-modal');
  otnModal.onclick = (event) => { if (event.target === otnModal) { otnModal.style.display = 'none'; } };

  // Initial setup
  openTab('oldToNew');
  otn_resetOldToNew();
  fetchLivePrice();
};
</script>
</body>
</html>
  @import url('https://fonts.googleapis.com/css2?family=Noto Sans Bengali:wght@400;600;700&display=swap');
  :root {
    --primary-color: #d4af37; /* Gold-inspired primary */
    --primary-dark: #b8941f;
    // ... (বাকি CSS আগের মতো)
  }
  // ... (সম্পূর্ণ CSS)
</style>
</head>
<body>
  // ... (আপনার দেওয়া সম্পূর্ণ HTML কনটেন্ট)
  <svg width="0" height="0" style="display:none;">
    // ... (SVG আইকন)
  </svg>
  <div class="header-bar">
    // ... (হেডার)
  </div>
  <div class="container">
    // ... (ট্যাব এবং কার্ড)
  </div>
  <footer class="site-footer">
    // ... (ফুটার)
  </footer>
  // ... (মোডাল)
<script>
// ... (আপনার দেওয়া সম্পূর্ণ JS কোড – calculateProfit, otn_calculateOldToNew ইত্যাদি)
</script>
</body>
</html>
